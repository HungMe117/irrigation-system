{"ast":null,"code":"// frontend/src/services/apiClient.js\n\n/**\r\n * Địa chỉ cơ sở cho Backend API.\r\n * Trong môi trường thực tế, giá trị này sẽ được lấy từ biến môi trường (environment variables).\r\n */\nconst API_BASE_URL = 'http://localhost:3000/api/v1';\n\n/**\r\n * Hàm chung để gọi API Backend.\r\n * Nó chịu trách nhiệm cho việc cấu hình headers, xử lý body, token xác thực, và xử lý phản hồi/lỗi.\r\n * * @param {string} endpoint - Ví dụ: 'auth/login', 'config/gateways/GW001'\r\n * @param {string} method - Ví dụ: 'GET', 'POST', 'PUT', 'DELETE'\r\n * @param {object | null} body - Dữ liệu gửi đi (chỉ dùng cho POST, PUT)\r\n * @param {string | null} token - JWT token để xác thực\r\n * @returns {Promise<any>} - Dữ liệu trả về từ API (sau khi đã parsed JSON)\r\n */\nexport const apiClient = async (endpoint, method = 'GET', body = null, token = null) => {\n  const url = `${API_BASE_URL}/${endpoint}`;\n  const headers = {\n    'Content-Type': 'application/json'\n  };\n\n  // Thêm header xác thực nếu có token\n  if (token) {\n    headers['Authorization'] = `Bearer ${token}`;\n  }\n  const config = {\n    method,\n    headers,\n    // body chỉ được thêm nếu method không phải GET hoặc HEAD\n    body: method !== 'GET' && method !== 'HEAD' && body ? JSON.stringify(body) : undefined\n  };\n  try {\n    const response = await fetch(url, config);\n\n    // Thử parse JSON trước khi kiểm tra response.ok\n    const data = await response.json().catch(() => ({})); // Trả về object rỗng nếu không phải JSON\n\n    if (!response.ok) {\n      // Xử lý lỗi HTTP (ví dụ: 400, 401, 500)\n      const status = response.status;\n      let errorMessage = data.message || `Lỗi máy chủ (${status} ${response.statusText})`;\n\n      // Xử lý trường hợp 401 (Unauthorized)\n      if (status === 401) {\n        errorMessage = \"Phiên hết hạn hoặc không có quyền truy cập. Vui lòng đăng nhập lại.\";\n      }\n      const error = new Error(errorMessage);\n      error.status = status;\n      throw error;\n    }\n\n    // Trả về toàn bộ dữ liệu (bao gồm cả { status: 'success', data: [...] } nếu API trả về như vậy)\n    return data;\n  } catch (error) {\n    console.error(\"Lỗi khi gọi API:\", error.message, error.status);\n    // Ném lỗi tiếp tục để AppContext/Component có thể bắt và hiển thị\n    throw error;\n  }\n};\n\n// Bạn có thể thêm các hàm helper cụ thể nếu cần, ví dụ:\n/*\r\nexport const loginUser = async (username, password) => {\r\n    return apiClient('auth/login', 'POST', { username, password });\r\n};\r\n*/","map":{"version":3,"names":["API_BASE_URL","apiClient","endpoint","method","body","token","url","headers","config","JSON","stringify","undefined","response","fetch","data","json","catch","ok","status","errorMessage","message","statusText","error","Error","console"],"sources":["C:/Users/admin/OneDrive - ptit.edu.vn/Desktop/Irrigation/frontend/src/services/apiClient.js"],"sourcesContent":["// frontend/src/services/apiClient.js\r\n\r\n/**\r\n * Địa chỉ cơ sở cho Backend API.\r\n * Trong môi trường thực tế, giá trị này sẽ được lấy từ biến môi trường (environment variables).\r\n */\r\nconst API_BASE_URL = 'http://localhost:3000/api/v1'; \r\n\r\n/**\r\n * Hàm chung để gọi API Backend.\r\n * Nó chịu trách nhiệm cho việc cấu hình headers, xử lý body, token xác thực, và xử lý phản hồi/lỗi.\r\n * * @param {string} endpoint - Ví dụ: 'auth/login', 'config/gateways/GW001'\r\n * @param {string} method - Ví dụ: 'GET', 'POST', 'PUT', 'DELETE'\r\n * @param {object | null} body - Dữ liệu gửi đi (chỉ dùng cho POST, PUT)\r\n * @param {string | null} token - JWT token để xác thực\r\n * @returns {Promise<any>} - Dữ liệu trả về từ API (sau khi đã parsed JSON)\r\n */\r\nexport const apiClient = async (endpoint, method = 'GET', body = null, token = null) => {\r\n    const url = `${API_BASE_URL}/${endpoint}`;\r\n    \r\n    const headers = {\r\n        'Content-Type': 'application/json',\r\n    };\r\n    \r\n    // Thêm header xác thực nếu có token\r\n    if (token) {\r\n        headers['Authorization'] = `Bearer ${token}`;\r\n    }\r\n\r\n    const config = {\r\n        method,\r\n        headers,\r\n        // body chỉ được thêm nếu method không phải GET hoặc HEAD\r\n        body: (method !== 'GET' && method !== 'HEAD' && body) ? JSON.stringify(body) : undefined,\r\n    };\r\n\r\n    try {\r\n        const response = await fetch(url, config);\r\n        \r\n        // Thử parse JSON trước khi kiểm tra response.ok\r\n        const data = await response.json().catch(() => ({})); // Trả về object rỗng nếu không phải JSON\r\n\r\n        if (!response.ok) {\r\n            // Xử lý lỗi HTTP (ví dụ: 400, 401, 500)\r\n            const status = response.status;\r\n            let errorMessage = data.message || `Lỗi máy chủ (${status} ${response.statusText})`;\r\n            \r\n            // Xử lý trường hợp 401 (Unauthorized)\r\n            if (status === 401) {\r\n                errorMessage = \"Phiên hết hạn hoặc không có quyền truy cập. Vui lòng đăng nhập lại.\";\r\n            }\r\n\r\n            const error = new Error(errorMessage);\r\n            error.status = status;\r\n            throw error;\r\n        }\r\n\r\n        // Trả về toàn bộ dữ liệu (bao gồm cả { status: 'success', data: [...] } nếu API trả về như vậy)\r\n        return data; \r\n    } catch (error) {\r\n        console.error(\"Lỗi khi gọi API:\", error.message, error.status);\r\n        // Ném lỗi tiếp tục để AppContext/Component có thể bắt và hiển thị\r\n        throw error; \r\n    }\r\n};\r\n\r\n// Bạn có thể thêm các hàm helper cụ thể nếu cần, ví dụ:\r\n/*\r\nexport const loginUser = async (username, password) => {\r\n    return apiClient('auth/login', 'POST', { username, password });\r\n};\r\n*/"],"mappings":"AAAA;;AAEA;AACA;AACA;AACA;AACA,MAAMA,YAAY,GAAG,8BAA8B;;AAEnD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAO,MAAMC,SAAS,GAAG,MAAAA,CAAOC,QAAQ,EAAEC,MAAM,GAAG,KAAK,EAAEC,IAAI,GAAG,IAAI,EAAEC,KAAK,GAAG,IAAI,KAAK;EACpF,MAAMC,GAAG,GAAG,GAAGN,YAAY,IAAIE,QAAQ,EAAE;EAEzC,MAAMK,OAAO,GAAG;IACZ,cAAc,EAAE;EACpB,CAAC;;EAED;EACA,IAAIF,KAAK,EAAE;IACPE,OAAO,CAAC,eAAe,CAAC,GAAG,UAAUF,KAAK,EAAE;EAChD;EAEA,MAAMG,MAAM,GAAG;IACXL,MAAM;IACNI,OAAO;IACP;IACAH,IAAI,EAAGD,MAAM,KAAK,KAAK,IAAIA,MAAM,KAAK,MAAM,IAAIC,IAAI,GAAIK,IAAI,CAACC,SAAS,CAACN,IAAI,CAAC,GAAGO;EACnF,CAAC;EAED,IAAI;IACA,MAAMC,QAAQ,GAAG,MAAMC,KAAK,CAACP,GAAG,EAAEE,MAAM,CAAC;;IAEzC;IACA,MAAMM,IAAI,GAAG,MAAMF,QAAQ,CAACG,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;IAEtD,IAAI,CAACJ,QAAQ,CAACK,EAAE,EAAE;MACd;MACA,MAAMC,MAAM,GAAGN,QAAQ,CAACM,MAAM;MAC9B,IAAIC,YAAY,GAAGL,IAAI,CAACM,OAAO,IAAI,gBAAgBF,MAAM,IAAIN,QAAQ,CAACS,UAAU,GAAG;;MAEnF;MACA,IAAIH,MAAM,KAAK,GAAG,EAAE;QAChBC,YAAY,GAAG,qEAAqE;MACxF;MAEA,MAAMG,KAAK,GAAG,IAAIC,KAAK,CAACJ,YAAY,CAAC;MACrCG,KAAK,CAACJ,MAAM,GAAGA,MAAM;MACrB,MAAMI,KAAK;IACf;;IAEA;IACA,OAAOR,IAAI;EACf,CAAC,CAAC,OAAOQ,KAAK,EAAE;IACZE,OAAO,CAACF,KAAK,CAAC,kBAAkB,EAAEA,KAAK,CAACF,OAAO,EAAEE,KAAK,CAACJ,MAAM,CAAC;IAC9D;IACA,MAAMI,KAAK;EACf;AACJ,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}