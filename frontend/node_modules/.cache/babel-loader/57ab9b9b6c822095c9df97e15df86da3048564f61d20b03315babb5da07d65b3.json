{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useState, useEffect, useCallback } from 'react';\nimport { io } from 'socket.io-client'; // üëà Th∆∞ vi·ªán th·∫≠t\nconst SOCKET_URL = 'http://localhost:3000';\nexport const useSocket = (token, onNewData, onStatusUpdate) => {\n  _s();\n  const [isConnected, setIsConnected] = useState(false);\n  const [socket, setSocket] = useState(null); // L∆∞u instance socket\n\n  useEffect(() => {\n    if (!token) return;\n    const newSocket = io(SOCKET_URL, {\n      query: {\n        token\n      }\n      // C√†i ƒë·∫∑t kh√°c: transport, reconnection, v.v.\n    });\n\n    // 1. L·∫Øng nghe tr·∫°ng th√°i k·∫øt n·ªëi\n    newSocket.on('connect', () => setIsConnected(true));\n    newSocket.on('disconnect', () => setIsConnected(false));\n\n    // 2. L·∫Øng nghe s·ª± ki·ªán d·ªØ li·ªáu c·∫£m bi·∫øn\n    newSocket.on('sensor_data', onNewData);\n\n    // 3. L·∫Øng nghe s·ª± ki·ªán c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒëi·ªÅu khi·ªÉn\n    newSocket.on('control_status', onStatusUpdate);\n    setSocket(newSocket);\n    return () => {\n      newSocket.off('connect');\n      newSocket.off('disconnect');\n      newSocket.off('sensor_data', onNewData);\n      newSocket.off('control_status', onStatusUpdate);\n      newSocket.close();\n    };\n  }, [token, onNewData, onStatusUpdate]);\n\n  // H√†m g·ª≠i l·ªánh ƒëi·ªÅu khi·ªÉn (Downlink)\n  const sendControlCommand = useCallback((nodeId, command, value) => {\n    if (socket && isConnected) {\n      socket.emit('control_valve', {\n        node_id: nodeId,\n        command: command,\n        // V√≠ d·ª•: 'OPEN', 'CLOSE', 'SET_THRESHOLD'\n        value: value // Gi√° tr·ªã ƒëi k√®m (n·∫øu c√≥)\n      });\n    }\n  }, [socket, isConnected]);\n  return {\n    isConnected,\n    sendControlCommand\n  };\n};\n_s(useSocket, \"2jmsxv+NpfchOW0DD4Fmd61CWfk=\");","map":{"version":3,"names":["useState","useEffect","useCallback","io","SOCKET_URL","useSocket","token","onNewData","onStatusUpdate","_s","isConnected","setIsConnected","socket","setSocket","newSocket","query","on","off","close","sendControlCommand","nodeId","command","value","emit","node_id"],"sources":["C:/Users/admin/OneDrive - ptit.edu.vn/Desktop/Irrigation/frontend/src/hooks/useSocket.js"],"sourcesContent":["import { useState, useEffect, useCallback } from 'react';\r\nimport { io } from 'socket.io-client'; // üëà Th∆∞ vi·ªán th·∫≠t\r\nconst SOCKET_URL = 'http://localhost:3000'; \r\n\r\nexport const useSocket = (token, onNewData, onStatusUpdate) => {\r\n    const [isConnected, setIsConnected] = useState(false);\r\n    const [socket, setSocket] = useState(null); // L∆∞u instance socket\r\n\r\n    useEffect(() => {\r\n        if (!token) return;\r\n\r\n        const newSocket = io(SOCKET_URL, { \r\n            query: { token },\r\n            // C√†i ƒë·∫∑t kh√°c: transport, reconnection, v.v.\r\n        });\r\n\r\n        // 1. L·∫Øng nghe tr·∫°ng th√°i k·∫øt n·ªëi\r\n        newSocket.on('connect', () => setIsConnected(true));\r\n        newSocket.on('disconnect', () => setIsConnected(false));\r\n        \r\n        // 2. L·∫Øng nghe s·ª± ki·ªán d·ªØ li·ªáu c·∫£m bi·∫øn\r\n        newSocket.on('sensor_data', onNewData);\r\n        \r\n        // 3. L·∫Øng nghe s·ª± ki·ªán c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒëi·ªÅu khi·ªÉn\r\n        newSocket.on('control_status', onStatusUpdate);\r\n\r\n        setSocket(newSocket);\r\n\r\n        return () => {\r\n            newSocket.off('connect');\r\n            newSocket.off('disconnect');\r\n            newSocket.off('sensor_data', onNewData);\r\n            newSocket.off('control_status', onStatusUpdate);\r\n            newSocket.close();\r\n        };\r\n    }, [token, onNewData, onStatusUpdate]);\r\n    \r\n    // H√†m g·ª≠i l·ªánh ƒëi·ªÅu khi·ªÉn (Downlink)\r\n    const sendControlCommand = useCallback((nodeId, command, value) => {\r\n        if (socket && isConnected) {\r\n            socket.emit('control_valve', {\r\n                node_id: nodeId,\r\n                command: command, // V√≠ d·ª•: 'OPEN', 'CLOSE', 'SET_THRESHOLD'\r\n                value: value // Gi√° tr·ªã ƒëi k√®m (n·∫øu c√≥)\r\n            });\r\n        }\r\n    }, [socket, isConnected]);\r\n\r\n    return { isConnected, sendControlCommand };\r\n};"],"mappings":";AAAA,SAASA,QAAQ,EAAEC,SAAS,EAAEC,WAAW,QAAQ,OAAO;AACxD,SAASC,EAAE,QAAQ,kBAAkB,CAAC,CAAC;AACvC,MAAMC,UAAU,GAAG,uBAAuB;AAE1C,OAAO,MAAMC,SAAS,GAAGA,CAACC,KAAK,EAAEC,SAAS,EAAEC,cAAc,KAAK;EAAAC,EAAA;EAC3D,MAAM,CAACC,WAAW,EAAEC,cAAc,CAAC,GAAGX,QAAQ,CAAC,KAAK,CAAC;EACrD,MAAM,CAACY,MAAM,EAAEC,SAAS,CAAC,GAAGb,QAAQ,CAAC,IAAI,CAAC,CAAC,CAAC;;EAE5CC,SAAS,CAAC,MAAM;IACZ,IAAI,CAACK,KAAK,EAAE;IAEZ,MAAMQ,SAAS,GAAGX,EAAE,CAACC,UAAU,EAAE;MAC7BW,KAAK,EAAE;QAAET;MAAM;MACf;IACJ,CAAC,CAAC;;IAEF;IACAQ,SAAS,CAACE,EAAE,CAAC,SAAS,EAAE,MAAML,cAAc,CAAC,IAAI,CAAC,CAAC;IACnDG,SAAS,CAACE,EAAE,CAAC,YAAY,EAAE,MAAML,cAAc,CAAC,KAAK,CAAC,CAAC;;IAEvD;IACAG,SAAS,CAACE,EAAE,CAAC,aAAa,EAAET,SAAS,CAAC;;IAEtC;IACAO,SAAS,CAACE,EAAE,CAAC,gBAAgB,EAAER,cAAc,CAAC;IAE9CK,SAAS,CAACC,SAAS,CAAC;IAEpB,OAAO,MAAM;MACTA,SAAS,CAACG,GAAG,CAAC,SAAS,CAAC;MACxBH,SAAS,CAACG,GAAG,CAAC,YAAY,CAAC;MAC3BH,SAAS,CAACG,GAAG,CAAC,aAAa,EAAEV,SAAS,CAAC;MACvCO,SAAS,CAACG,GAAG,CAAC,gBAAgB,EAAET,cAAc,CAAC;MAC/CM,SAAS,CAACI,KAAK,CAAC,CAAC;IACrB,CAAC;EACL,CAAC,EAAE,CAACZ,KAAK,EAAEC,SAAS,EAAEC,cAAc,CAAC,CAAC;;EAEtC;EACA,MAAMW,kBAAkB,GAAGjB,WAAW,CAAC,CAACkB,MAAM,EAAEC,OAAO,EAAEC,KAAK,KAAK;IAC/D,IAAIV,MAAM,IAAIF,WAAW,EAAE;MACvBE,MAAM,CAACW,IAAI,CAAC,eAAe,EAAE;QACzBC,OAAO,EAAEJ,MAAM;QACfC,OAAO,EAAEA,OAAO;QAAE;QAClBC,KAAK,EAAEA,KAAK,CAAC;MACjB,CAAC,CAAC;IACN;EACJ,CAAC,EAAE,CAACV,MAAM,EAAEF,WAAW,CAAC,CAAC;EAEzB,OAAO;IAAEA,WAAW;IAAES;EAAmB,CAAC;AAC9C,CAAC;AAACV,EAAA,CA7CWJ,SAAS","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}